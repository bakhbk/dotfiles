# ====================== OLLAMA FZF FUNCTIONS ======================

# –ó–∞–ø—É—Å–∫ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ fzf
ollama-fzf() {
  local MODEL
  MODEL=$(ollama list | awk 'NR>1 {print $1}' | fzf \
    --height=40% \
    --layout=reverse \
    --border=rounded \
    --prompt="üöÄ –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å > " \
    --header="üìö –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Ç–º–µ–Ω—ã" \
    --preview="echo '–ó–∞–ø—É—Å–∫: {}'" \
    --preview-window=right:30%:wrap)

  if [[ -n "$MODEL" ]]; then
    echo "–ó–∞–ø—É—Å–∫–∞–µ–º: $MODEL"
    ollama run "$MODEL"
  fi
}
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ fzf —Å –ø–æ–∏—Å–∫–æ–º
ollama-pull-fzf() {
  local selection
  selection=$(
    cat <<'EOF' | fzf \
      --height=50% \
      --layout=reverse \
      --border=rounded \
      --prompt="üì• –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ > " \
      --header="üîç –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ / –¥–ª—è –ø–æ–∏—Å–∫–∞, Tab –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö" \
      --multi \
      --preview='echo -e "–ú–æ–¥–µ–ª—å: $(echo {} | cut -d"|" -f1)\n\n–û–ø–∏—Å–∞–Ω–∏–µ: $(echo {} | cut -d"|" -f2)"' \
      --preview-window=right:50%:wrap \
      --with-nth=1,2 \
      --delimiter="\|"
# üöÄ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò (–Ω–∞—á–Ω–∏ —Å —ç—Ç–∏—Ö)
deepseek-coder:6.7b|ü§ñ [Agent] –ê–ª–≥–æ—Ä–∏—Ç–º—ã, –æ–±—É—á–µ–Ω–∏–µ, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π, –∫–æ–¥ (4.1GB)
llama3.1:8b|üìö –û–±—É—á–µ–Ω–∏–µ, –∞–Ω–∞–ª–∏–∑, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è (4.7GB)
phi3:mini|üéØ –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –∏ —É–º–Ω–∞—è, –º–∞–ª–æ –ø–∞–º—è—Ç–∏, –±—ã—Å—Ç—Ä–∞—è (2.3GB)
qwen2.5-coder:7b|ü•á –ë–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏/–∫–∞—á–µ—Å—Ç–≤–∞, —Ä—É—Å—Å–∫–∏–π, Dart (4.1GB)

# ü§ñ –ê–ì–ï–ù–¢–ù–´–ï –ò –ö–û–î–û–í–´–ï
codestral:latest|üöÄ [Agent] –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–ª—è –∫–æ–¥–∞, –∞–≤—Ç–æ-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (8.7GB)
codeqwen:7b|üë®‚Äçüíª –ß–∏—Å—Ç–æ –∫–æ–¥–æ–≤–∞—è, –±—ã—Å—Ç—Ä–æ –æ—Ç–≤–µ—á–∞–µ—Ç, —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (4.1GB)
wizardcoder:7b|üßô‚Äç‚ôÇÔ∏è [Agent] –ê–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏, –∞–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (4.1GB)
codellama:7b|üêç Python-—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, —Ö–æ—Ä–æ—à –¥–ª—è –æ–±—É—á–µ–Ω–∏—è (3.8GB)
granite-code:3b|üíé [Agent] IBM, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –º–∞–ª–æ –ø–∞–º—è—Ç–∏ (1.8GB)

# ‚ö° –ë–´–°–¢–†–´–ï –ò –õ–ï–ì–ö–ò–ï
tinyllama:latest|‚ö° –ú–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω–∞—è, –ø—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏, –ø—Ä–æ—Ç–æ—Ç–∏–ø—ã (628MB)
phi2:2.7b|üîç –•–æ—Ä–æ—à–∏–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è, –º–∞–ª–æ –ø–∞–º—è—Ç–∏ (1.6GB)
gemma:2b|üíé –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ –ª–µ–≥–∫–∞—è, –±–∞–∑–æ–≤—ã–π –∫–æ–¥ (1.4GB)
llama3.2:1b|üéØ –ú–∏–Ω–∏ –≤–µ—Ä—Å–∏—è, —Å—É–ø–µ—Ä-–±—ã—Å—Ç—Ä–∞—è (580MB)

# üí¨ –û–ë–©–ï–ù–ò–ï –ò –†–£–°–°–ö–ò–ô
neural-chat:7b|üí¨ –õ—É—á—à–∞—è –¥–ª—è –æ–±—â–µ–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º, –∫–æ–¥-—Ä–µ–≤—å—é (4.1GB)
dolphin2.5-mixtral:8x7b|üê¨ –£–º–Ω–∞—è, –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–∞—è, –æ–±—É—á–µ–Ω–∏–µ (26GB)
openhermes:7b|üìö –û–±—É—á–µ–Ω–∏–µ, –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, —Ç—É—Ç–æ—Ä–∏–∞–ª—ã (4.1GB)
solar:10.7b|‚òÄÔ∏è –ê–Ω–≥–ª–∏–π—Å–∫–∏–π, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –æ–±—É—á–µ–Ω–∏–µ (6.1GB)

# üåê –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ï
mistral:7b|üå™Ô∏è –•–æ—Ä–æ—à–∞—è –æ–±—â–∞—è –º–æ–¥–µ–ª—å, multi-lingual (4.1GB)
llama3:8b|üåê –û–±—â–∞—è —ç—Ä—É–¥–∏—Ü–∏—è, —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è (4.7GB)
yi:34b|üá®üá≥ –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–∞—è, –±–æ–ª—å—à–∞—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –ø–∞–º—è—Ç—å (20GB)
falcon2:11b|ü¶Ö –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –±—ã—Å—Ç—Ä–∞—è (5.9GB)

# üóÑÔ∏è –°–ü–ï–¶–ò–ê–õ–ò–ó–ò–†–û–í–ê–ù–ù–´–ï
sqlcoder:7b|üóÑÔ∏è –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ SQL, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î (4.1GB)
meditron:7b|üè• –ê–Ω–∞–ª–∏–∑ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö/—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤ (4.1GB)
llava:7b|üñºÔ∏è [Vision] –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —Å–∫—Ä–∏–Ω—à–æ—Ç—ã (4.1GB)
nomic-embed-text|üìä Embedding, —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ (274MB)

# üî¨ –≠–ö–°–ü–ï–†–ò–ú–ï–ù–¢–ê–õ–¨–ù–´–ï
command-r:35b|üéñÔ∏è RAG-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è, –ø–æ–∏—Å–∫ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º (20GB)
dbrx:latest|üèéÔ∏è –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç Mixtral (36GB)
EOF
  )

  if [[ -n "$selection" ]]; then
    echo "$selection" | while IFS='|' read -r model description; do
      # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
      if [[ "$model" == "#"* ]]; then
        continue
      fi
      echo "üì• –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é: $model - $description"
      ollama pull "$model"
    done
  else
    echo "‚ùå –ú–æ–¥–µ–ª—å –Ω–µ –≤—ã–±—Ä–∞–Ω–∞"
  fi
}

# –£–¥–∞–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ fzf
ollama-rm-fzf() {
  local MODEL
  MODEL=$(ollama list | awk 'NR>1 {print $1}' | fzf \
    --height=40% \
    --layout=reverse \
    --border=rounded \
    --prompt="üóëÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è > " \
    --header="‚ö†Ô∏è  –í–Ω–∏–º–∞–Ω–∏–µ: —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!" \
    --preview="echo '–ë—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞: {}'" \
    --preview-window=right:30%:wrap)

  if [[ -n "$MODEL" ]]; then
    echo -n "‚ùå –£–¥–∞–ª–∏—Ç—å –º–æ–¥–µ–ª—å '$MODEL'? (y/N): "
    read -r answer
    if [[ "$answer" =~ ^[Yy]$ ]]; then
      ollama rm "$MODEL"
      echo "‚úÖ –ú–æ–¥–µ–ª—å —É–¥–∞–ª–µ–Ω–∞"
    fi
  fi
}

# Aider —Å –≤—ã–±–æ—Ä–æ–º –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ fzf
aider-fzf() {
  local MODEL
  MODEL=$(ollama list | awk 'NR>1 {print $1}' | fzf \
    --height=40% \
    --layout=reverse \
    --border=rounded \
    --prompt="ü§ñ –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –¥–ª—è aider > " \
    --header="üë®‚Äçüíª –ú–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è" \
    --preview="echo '–ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞: {} –≤ aider'" \
    --preview-window=right:30%:wrap)

  # –£–±–∏—Ä–∞–µ–º trailing newline
  MODEL=$(printf '%s' "$MODEL")

  if [[ -n "$MODEL" ]]; then
    echo "–ó–∞–ø—É—Å–∫–∞–µ–º aider —Å –º–æ–¥–µ–ª—å—é: $MODEL"
    OPENAI_API_KEY=dummy aider --model "ollama/$MODEL" --yes
  else
    echo "‚ùå –ú–æ–¥–µ–ª—å –Ω–µ –≤—ã–±—Ä–∞–Ω–∞"
  fi
}

# Aider —Å –±—ã—Å—Ç—Ä—ã–º –≤—ã–±–æ—Ä–æ–º –∫–æ–¥–æ–≤–æ–π –º–æ–¥–µ–ª–∏
aider-code() {
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–æ–¥–æ–≤—ã–µ –º–æ–¥–µ–ª–∏
  local code_models=$(ollama list | awk 'NR>1 {print $1}' | grep -E "(coder|codellama|codeqwen|deepseek|starcoder|wizard)")

  if [[ -z "$code_models" ]]; then
    echo "‚ö†Ô∏è  –ù–µ—Ç –∫–æ–¥–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ–¥–Ω—É:"
    echo "   ollama pull deepseek-coder:6.7b"
    return 1
  fi

  local MODEL=$(echo "$code_models" | fzf \
    --height=30% \
    --layout=reverse \
    --prompt="üë®‚Äçüíª –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–¥–æ–≤—É—é –º–æ–¥–µ–ª—å > ")

  if [[ -n "$MODEL" ]]; then
    echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º aider —Å $MODEL"
    aider --model ollama/"$MODEL" --yes
  fi
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
ollama-list() {
  echo "üìö –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏:"
  echo ""
  ollama list | awk '
    NR==1 {printf "%-30s %-10s %s\n", "–ú–æ–¥–µ–ª—å", "–†–∞–∑–º–µ—Ä", "–î–∞—Ç–∞"; print "----------------------------------------------------------------"}
    NR>1 {printf "%-30s %-10s %s\n", $1, $2, $3" "$4}
    '
}

# –ë—ã—Å—Ç—Ä—ã–π —á–∞—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–æ–¥–µ–ª—å—é
ollama-last() {
  local last_model=$(ollama list | awk 'NR==2 {print $1}')
  if [[ -n "$last_model" ]]; then
    echo "üí¨ –ó–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–æ–¥–µ–ª–∏: $last_model"
    ollama run "$last_model"
  else
    echo "‚ùå –ù–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π"
  fi
}

# ====================== –ê–õ–ò–ê–°–´ ======================
alias om="ollama-fzf"       # –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –º–æ–¥–µ–ª–∏
alias omp="ollama-pull-fzf" # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥–µ–ª–∏
alias omr="ollama-rm-fzf"   # –£–¥–∞–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
alias oml="ollama-list"     # –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π
alias omc="aider-code"      # Aider —Å –∫–æ–¥–æ–≤–æ–π –º–æ–¥–µ–ª—å—é
alias af="aider-fzf"        # Aider —Å –≤—ã–±–æ—Ä–æ–º –º–æ–¥–µ–ª–∏
alias oll="ollama-last"     # –ü–æ—Å–ª–µ–¥–Ω—è—è –º–æ–¥–µ–ª—å
